@page "/ticket"
@using BioscoopSysteemWeb.Models
@using System.Web
@inject IJSRuntime Js
@inject NavigationManager NavigationManager
@inject HttpClient HttpClient


<h3 class="d-print-none">Betaling geslaagd</h3>

<p class="d-print-none">Uw betaling is geslaagd. Hieronder kunt u uw ticket printen.</p>
<button type="button" class="btn btn-primary d-print-none" @onclick="PrintTicket">Print Ticket</button>

@if (reservation != null)
{
    @for (int i = 1; i <= reservation.TicketAmount; i++)
    {
        <Ticket TicketNumber="@i" TotalPrice="reservation.TotalPrice"/>
    }
}

@code {
    private async Task PrintTicket()
    {
        await Js.InvokeVoidAsync("printPage");
    }
    
    [Parameter]
    public string ResId { get; set; }
    public ReservationModel reservation { get; set; }
    
    protected override void OnInitialized()
    {
        var uri = new Uri(NavigationManager.Uri);
        var queryParam = HttpUtility.ParseQueryString(uri.Query);
        ResId = queryParam["resid"];
    }
    
    protected override async Task OnInitializedAsync()
    {
        reservation = await GetMyModelById();
    }
    
    public async Task<ReservationModel> GetMyModelById()
    {
        if (!string.IsNullOrEmpty(ResId)) {
            return await HttpClient.GetFromJsonAsync<ReservationModel>($"/api/reservations/{ResId}");
        }
        return null;
    }


}
